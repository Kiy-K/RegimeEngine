# Battle of Stalingrad (1942–1943) — Modern Warfare Regime
# ==========================================================
# Simulates the Eastern Front's decisive urban battle:
#   Aug 23, 1942 – Feb 2, 1943
#   German 6th Army (Paulus) vs. Soviet forces (Zhukov / Chuikov)
#
# 8 clusters representing key operational sectors:
#   0  Stalingrad City Center     — contested ruins, extreme hazard
#   1  Tractor / Red October      — industrial zone, axis of main German attack
#   2  Mamayev Kurgan             — strategic hill dominating the city
#   3  Volga Crossing / Ferry     — Soviet lifeline across the river
#   4  Northern Don River Line    — German flank, Axis defensive arc
#   5  Axis Supply Corridor       — overextended Axis logistics, exhaustion sink
#   6  Soviet Strategic Reserve   — buildup for Operation Uranus
#   7  Romanian / Italian Sector  — weak Axis southern flank
#   8  Wintergewitter Corridor   — Hoth's 4th Panzer Army relief push from Kotelnikovo
#
# Diplomacy dimension:
#   Axis clusters (0,1,2,4,5,7) start mildly allied
#   Soviet clusters (2,3,6) start mildly allied
#   Seam clusters (4,7 vs 3,6) start mildly hostile
#   DIPLOMACY action can shift alliance to coordinate flanks
#
# Key mechanics:
#   - High military ceiling (total war)
#   - Exhaustion accumulates fast (urban grind, winter, supply failure)
#   - Hawkes self-excitation high (combat cascades)
#   - Propaganda: "Not one step back!" / German Festung doctrine
#   - Alliance: coordinate flanks via DIPLOMACY stance
#

# ── Training config ─────────────────────────────────────────────────────── #
training:
  total_timesteps: 3000000
  n_envs: 8
  mode: curriculum
  use_subproc: true
  population: false

# ── GravitasParams overrides ─────────────────────────────────────────────── #
# These override the defaults in GravitasParams when loaded via regime_loader.
params:
  # Topology
  n_clusters_min: 9
  n_clusters_max: 9
  dt: 0.01

  # Stability dynamics — war-torn baseline
  alpha_sigma: 0.04       # slow structural recovery (ruins don't rebuild fast)
  nu_sigma:    0.08       # spatial stability diffusion (flanks affect centre)
  beta_sigma:  1.80       # hazard strongly suppresses stability

  # Resource dynamics — supply attrition
  alpha_res:       0.03   # very slow resource recovery (supply lines cut)
  hazard_res_cost: 0.25   # combat burns resources aggressively

  # Military dynamics — total war
  max_military_total:      0.92   # nearly every unit deployed
  military_exh_coeff:      0.45   # heavy military = fast exhaustion
  military_decay:          0.02   # troops hold positions under fire
  military_hazard_reduction: 0.60 # urban warfare: military suppresses hazard
  military_sigma_boost:    0.25   # fortified positions add stability
  military_tau_cost:       0.18   # occupation erodes civilian trust
  military_phi_coeff:      0.12   # heavy militarisation → fragmentation

  # Trust / polarization — ideological total war
  tau_decay:            0.04   # trust erodes quickly under occupation
  alpha_pol:            0.12   # polarization builds fast
  beta_pol:             0.06   # hard to depolarise during combat
  propaganda_pol_coeff: 0.20   # propaganda intensifies ideological split
  psi_propaganda_cost:  0.15   # coherence suffers under heavy propaganda

  # Exhaustion — Stalingrad's defining pressure
  alpha_exh:  0.08   # exhaustion accumulates quickly
  beta_exh:   0.03   # recovery is very slow

  # Hawkes shock process — constant combat shocks
  hawkes_base_rate: 0.030
  hawkes_alpha:     0.22    # high self-excitation (one battle triggers more)
  hawkes_beta:      0.40    # moderate decay (combat sessions linger)
  shock_pareto_alpha: 2.0   # heavy-tailed magnitude (big offensives happen)
  shock_pareto_xmin:  0.12

  # Diplomacy — inter-sector coordination
  nu_alliance:      0.06    # allied sectors share stability fast (flanks matter)
  nu_res_alliance:  0.04    # allied sectors share supply
  alpha_hostility:  0.03    # hostile sectors erode each other's trust
  alliance_decay:   0.004   # alliance values persist longer under fire
  diplomacy_shift:  0.12    # aggressive diplomatic manoeuvre possible

  # Media / propaganda
  rho_bias:      0.90   # strong propaganda persistence
  beta_max_bias: 0.60   # extreme media distortion possible
  media_autonomy: 0.25  # agent can override propaganda easily (state media)

  # Reward weights — prioritize exhaustion and stability under fire
  w_stability:     1.50
  w_fragmentation: 0.70
  w_polarization:  0.90
  w_exhaustion:    2.00   # exhaustion is the primary kill mechanism
  w_resilience:    0.50
  w_smoothness:    0.20
  w_unsustainable: 2.50

  # Termination — armies fight to near-annihilation
  collapse_exhaustion:    0.93
  collapse_hazard_mean:   1.80   # very high hazard needed for total collapse
  collapse_polarization:  0.96
  collapse_fragmentation: 0.94

  # Episode length — ~180 days of fighting
  max_steps: 500

# ── Operational sectors (nation-to-cluster) ─────────────────────────────── #
sectors:
  - id: 0
    name: StalingradCityCenter
    side: Axis
    description: "Contested ruins of central Stalingrad. Block-by-block fighting."
    initial_state:
      sigma:    0.18   # near-total instability
      hazard:   0.85
      resource: 0.25   # supply almost gone
      military: 0.75   # heavy garrison
      trust:    0.20   # population hostile / evacuated
      polar:    0.80

  - id: 1
    name: TractorFactoryDistrict
    side: Axis
    description: "Industrial zone. Workers fought inside running factories."
    initial_state:
      sigma:    0.22
      hazard:   0.75
      resource: 0.30
      military: 0.70
      trust:    0.25
      polar:    0.75

  - id: 2
    name: MamayevKurgan
    side: Contested
    description: "Hill 102. Changed hands many times. Whoever holds it, wins."
    initial_state:
      sigma:    0.15
      hazard:   0.90
      resource: 0.20
      military: 0.80
      trust:    0.18
      polar:    0.82

  - id: 3
    name: VolgaCrossing
    side: Soviet
    description: "Ferry routes across the Volga. Bombed daily. Soviet lifeline."
    initial_state:
      sigma:    0.35
      hazard:   0.55
      resource: 0.60   # supplies arriving, but under fire
      military: 0.45
      trust:    0.50
      polar:    0.45

  - id: 4
    name: NorthernDonRiverLine
    side: Axis
    description: "German defensive arc north of Stalingrad. Thinly held."
    initial_state:
      sigma:    0.45
      hazard:   0.35
      resource: 0.40
      military: 0.50
      trust:    0.35
      polar:    0.40

  - id: 5
    name: AxisSupplyCorridor
    side: Axis
    description: "Overextended supply route from Rostov. 600km vulnerable line."
    initial_state:
      sigma:    0.50
      hazard:   0.25
      resource: 0.35   # supply always critically low
      military: 0.30
      trust:    0.40
      polar:    0.30

  - id: 6
    name: SovietStrategicReserve
    side: Soviet
    description: "Tank armies and rifles building up for Operation Uranus."
    initial_state:
      sigma:    0.65
      hazard:   0.15
      resource: 0.75   # Uranus buildup
      military: 0.55
      trust:    0.65
      polar:    0.25

  - id: 7
    name: RomanianItalianSector
    side: Axis
    description: "Weak Axis southern flank. Low morale, poor equipment."
    initial_state:
      sigma:    0.40
      hazard:   0.30
      resource: 0.35
      military: 0.35   # understrength divisions
      trust:    0.30   # allied troops, not German — trust is low
      polar:    0.50

  - id: 8
    name: WintergewitterCorridor
    side: Axis
    description: "Hoth's 4th Panzer Army relief push from Kotelnikovo. Fresh troops, tanks, supplies — but 120km to cover under Soviet fire."
    initial_state:
      sigma:    0.55   # fresh organized force, not yet under siege
      hazard:   0.30   # advancing into contested steppe
      resource: 0.65   # well-supplied relief column
      military: 0.70   # 6th Panzer Division spearhead + 57th Panzer Corps
      trust:    0.50   # German regulars, high morale initially
      polar:    0.25

# ── Initial alliance matrix overrides ───────────────────────────────────── #
# Positive = cooperative, Negative = hostile
# Loaded by regime_loader to initialise the alliance field in GravitasWorld
initial_alliances:
  # Axis core: city, factory, hill, Don line are aligned
  - {from: 0, to: 1, value:  0.35}   # city ↔ factory: German main axis
  - {from: 0, to: 2, value:  0.25}   # city ↔ Mamayev Kurgan
  - {from: 0, to: 4, value:  0.20}   # city ↔ Don line
  - {from: 1, to: 2, value:  0.30}   # factory ↔ hill
  - {from: 4, to: 5, value:  0.25}   # Don line ↔ supply corridor
  - {from: 4, to: 7, value:  0.15}   # German flank ↔ Romanian sector
  - {from: 5, to: 7, value:  0.20}   # supply ↔ Romanian sector
  # Soviet core: Volga crossing, hill (contested), reserve are aligned
  - {from: 3, to: 6, value:  0.40}   # Volga crossing ↔ strategic reserve
  - {from: 2, to: 3, value:  0.15}   # Mamayev Kurgan ↔ Volga (Soviet hold)
  # Seam hostilities (Axis supply vs Soviet reserve)
  - {from: 5, to: 6, value: -0.30}   # supply corridor threatened by reserves
  - {from: 7, to: 6, value: -0.35}   # Romanian flank vs Uranus armies
  - {from: 4, to: 3, value: -0.20}   # Don line vs Volga lifeline
  - {from: 0, to: 3, value: -0.45}   # city centre vs Volga crossing (cut it off)
  # Wintergewitter corridor alliances
  - {from: 8, to: 5, value:  0.35}   # relief column ↔ supply corridor (link up objective)
  - {from: 8, to: 7, value:  0.20}   # relief column ↔ Romanian sector (right flank)
  - {from: 8, to: 4, value:  0.15}   # relief column ↔ Don line (northern coordination)
  - {from: 8, to: 6, value: -0.40}   # relief column vs Soviet reserve (direct opposition)

# ── Historical shocks ────────────────────────────────────────────────────── #
custom_shocks:
  - name: WinterBlizzard
    probability: 0.025
    effect_type: global
    description: "Sudden drop to -30°C. Freezes equipment, drains exhaustion reserves."
    params_delta:
      exhaustion_boost: +0.08
      resource_drain:   +0.06
    historical_note: "The Russian winter arrived November 1942, paralyzing the 6th Army's logistics."

  - name: LuftwaffeAirlift
    probability: 0.018
    effect_type: cluster
    target_cluster: 5
    description: "Attempted Luftwaffe supply airlift. Partial. Buys time."
    params_delta:
      resource_boost: +0.10
      exhaustion_relief: -0.04
    historical_note: "Göring promised 300 tons/day; Luftwaffe delivered ~100."

  - name: SovietCounterattack
    probability: 0.020
    effect_type: cluster
    target_cluster: 7
    description: "Local Soviet probe on the Romanian/Italian sector."
    params_delta:
      hazard_boost: +0.15
      sigma_drop:   -0.10
    historical_note: "Probing attacks before Operation Uranus revealed weak Axis flanks."

  - name: OperationUranus
    probability: 0.008
    effect_type: multi_cluster
    target_clusters: [7, 4]
    description: "Soviet double envelopment (Uranus). Axis flanks collapse. Encirclement begins."
    params_delta:
      hazard_boost:   +0.35
      sigma_drop:     -0.25
      military_drain: +0.20
      alliance_shift: -0.25   # Axis alliance collapses as flanks fold
    historical_note: "Nov 19-23, 1942: Southwest / Don Fronts crushed Romanian 3rd Army."

  - name: AxisKessel
    probability: 0.012
    effect_type: cluster
    target_cluster: 5
    description: "Supply corridor cut. 6th Army encircled. Logistics collapse."
    params_delta:
      resource_drain:   +0.30
      exhaustion_boost: +0.15
    historical_note: "By Nov 23, 330,000 Axis troops were surrounded inside the Kessel."

  - name: SovietVolleyFire
    probability: 0.035
    effect_type: cluster
    target_cluster: 2
    description: "Katyusha rocket barrage on Mamayev Kurgan."
    params_delta:
      hazard_boost: +0.20
      sigma_drop:   -0.12
    historical_note: "Soviet rocket artillery made the hill uninhabitable but contested."

  - name: GermanCounterattack
    probability: 0.022
    effect_type: cluster
    target_cluster: 1
    description: "German local counter-push in the factory district."
    params_delta:
      hazard_boost:  +0.18
      military_surge: +0.10
    historical_note: "Wehrmacht seized the factory roof while Soviet workers assembled tanks below."

  - name: ReinforcedGuards
    probability: 0.020
    effect_type: cluster
    target_cluster: 3
    description: "Soviet Guards division crosses the Volga at night."
    params_delta:
      sigma_boost:   +0.12
      military_surge: +0.15
      trust_boost:   +0.08
    historical_note: "Chuikov's 62nd Army received continuous reinforcements across the Volga."

  - name: OperationWinterStorm
    probability: 0.015
    effect_type: cluster
    target_cluster: 8
    description: "Hoth launches Wintergewitter! 6th Panzer Division breaks through. Relief column surges forward."
    params_delta:
      military_surge: +0.20
      sigma_boost:    +0.15
      resource_boost: +0.10
      hazard_boost:   +0.12
    historical_note: "Dec 12, 1942: LVII Panzer Corps attacked from Kotelnikovo. Got within 48km of the pocket."

  - name: OperationLittleSaturn
    probability: 0.010
    effect_type: multi_cluster
    target_clusters: [8, 7]
    description: "Soviet Operation Little Saturn cuts into Hoth's flank. 2nd Guards Army blocks the relief."
    params_delta:
      hazard_boost:   +0.30
      sigma_drop:     -0.20
      military_drain: +0.15
      resource_drain: +0.15
    historical_note: "Dec 16-30: Vatutin's Southwest Front destroyed Italian 8th Army, forcing Hoth to retreat."

  - name: PanzerSpearhead
    probability: 0.025
    effect_type: cluster
    target_cluster: 8
    description: "German armor pushes closer to the Kessel. 'We can see the flares from 6th Army!'"
    params_delta:
      sigma_boost:    +0.08
      military_surge: +0.12
      hazard_boost:   +0.15
    historical_note: "The 6th Panzer Division's advance guard reached the Myshkova River, 48km from the pocket."

  - name: SovietGuardsBlock
    probability: 0.022
    effect_type: cluster
    target_cluster: 8
    description: "Malinovsky's 2nd Guards Army deploys to block the relief corridor."
    params_delta:
      hazard_boost:   +0.25
      sigma_drop:     -0.15
      military_drain: +0.10
    historical_note: "The fresh 2nd Guards Army stopped Hoth's exhausted panzers at the Myshkova River."

# ── Agents ──────────────────────────────────────────────────────────────── #
agents:
  - name: GermanSixthArmy
    side: Axis
    policy: RecurrentPPO
    controlled_clusters: [0, 1, 2, 4, 5, 8]
    primary_objective: [hold_city, protect_supply]
    diplomacy_bias: allied_flanks   # tends to use DIPLOMACY toward 4,7

  - name: SovietFronts
    side: Soviet
    policy: RecurrentPPO
    controlled_clusters: [3, 6]
    primary_objective: [encircle, attrition]
    diplomacy_bias: coordinate_reserve   # uses DIPLOMACY toward reserve buildup

# ── Notes ────────────────────────────────────────────────────────────────── #
# 1. `initial_state` values are scenario overrides loaded by regime_loader.
# 2. `initial_alliances` can be applied by regime_loader to world.alliance.
# 3. `params` block overrides GravitasParams defaults when loaded.
# 4. `OperationUranus` and `AxisKessel` are rare high-impact shocks that
#    represent the historical turning point — they force the agent to adapt.
# 5. DIPLOMACY stance is especially important: coordinating the Don line with
#    the supply corridor delays encirclement; Soviet coordination of reserve
#    with the Volga crossing accelerates it.
